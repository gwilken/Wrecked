<!DOCTYPE html>
<html>
  <head>
    <title>Wrecked</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <link href="assets/css/reset.css" type="text/css" rel="stylesheet">
    <link href="assets/css/style.css" type="text/css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
    <script src="assets/javascript/app.js" type="text/javascript"></script>
  </head>
  <body>
    <div class="main-container">
      <div class="heading">
        <div class="logo">
          <img src="assets/images/logo.png">
        </div>
      </div>
      <div class="content">
        <div id="map">
        </div>
      </div>
      <div class="footer">
      </div>
    </div>
    <script>

    function userLocation() {
    if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function(position) {
                latitude = position.coords.latitude;
                longitude = position.coords.longitude;
                console.log(latitude + " : " + longitude);
            }, function(error) {
                if (error.code == error.PERMISSION_DENIED) {
                    latitude = 34.179107;
                    longitude = -118.600565;
                    console.log(latitude + " : " + longitude);
                }
            })
        }
    }

    userLocation();
    // console.log(latitude + " : " + longitude);

     //Initialie map centered on user location with specified zoom (radius)

var map;

      function initMap() {
        map = new google.maps.Map(document.getElementById('map'), {
          zoom: 2,
          center: {lat: 25.048715, lng: -77.355493}
        });

        if (navigator.geolocation) {
         navigator.geolocation.getCurrentPosition(function (position) {
             initialLocation = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
             map.setCenter(initialLocation);
             map.setZoom(10);
         });
     }

        setMarkers(map);
      }

      // Data for the markers consisting of a name, a LatLng and a zIndex for the
      // order in which these markers should display on top of each other.
      var wrecks = [];

      $.ajax({
        url: "http://www.rednightsky.com/proximity",
        method: "GET",
        data: {
          lat: 33.998014,
          lon: -118.823274,
          radius: 50000
        }
      }).done(function(response) {
         console.log(response);
         gresult = response;
         for (var i = 0; i < gresult.length; i++) {
            var holder = []
            holder.push(gresult[i].properties.vesslterms);
            holder.push(gresult[i].geometry.coordinates[1]);
            holder.push(gresult[i].geometry.coordinates[0]);
            wrecks.push(holder);
            setMarkers(map);
         }
         console.log(wrecks);
        })
  


       /*function Wreck(i){
         
             this.name = gresult[0][i].properties.vesslterms;
             this.lng = gresult[0][i].geometry.coordinates[0];
             this.lat = gresult[0][i].geometry.coordinates[1];
         }*/


      function setMarkers(map) {
        // Adds markers to the map.

        // Marker sizes are expressed as a Size of X,Y where the origin of the image
        // (0,0) is located in the top left of the image.

        // Origins, anchor positions and coordinates of the marker increase in the X
        // direction to the right and in the Y direction down.
        var image = {
          url: 'https://cdn4.iconfinder.com/data/icons/sin-city-memories/128/treasure-chest3-2-128.png',
          // This marker is 20 pixels wide by 32 pixels high.
          size: new google.maps.Size(20, 32),
          // The origin for this image is (0, 0).
          origin: new google.maps.Point(0, 0),
          // The anchor for this image is the base of the flagpole at (0, 32).
          anchor: new google.maps.Point(0, 32)
        };
        // Shapes define the clickable region of the icon. The type defines an HTML
        // <area> element 'poly' which traces out a polygon as a series of X,Y points.
        // The final coordinate closes the poly by connecting to the first coordinate.
        var shape = {
          coords: [1, 1, 1, 20, 18, 20, 18, 1],
          type: 'poly'
        };
        for (var i = 0; i < wrecks.length; i++) {
          createMarkers(i);
                  }
          function createMarkers(i) {
          var wreck = wrecks[i];
          var marker = new google.maps.Marker({
            position: {lat: wreck[1], lng: wreck[2]},
            map: map,
            icon: image,
            shape: shape,
            title: wreck[0],
            label: wreck[0],
            // zIndex: wreck[3]
          });
            var contentString =
          '<p class="info"><strong>Wreck: ' + wreck[0] + '</strong><br><strong>Date:</strong><br><strong>History:</strong><br><br><button id="' + wreck[0] + '">Get Articles</button></p>';
            var infowindow = new google.maps.InfoWindow({
          content: contentString
      });
            marker.addListener('click', function() {
          infowindow.open(map, marker);
      });
        }

      }


    </script>
    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDqnwhdbOUa3osuMBS5mA0v6FLNKFMBxF8&callback=initMap">
    </script>
  </body>
</html>